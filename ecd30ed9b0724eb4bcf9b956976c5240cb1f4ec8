{
  "comments": [
    {
      "key": {
        "uuid": "05510c6b_686b0d88",
        "filename": "src/crypto/tls/tls.go",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 14770
      },
      "writtenOn": "2018-01-09T20:39:56Z",
      "side": 1,
      "message": "Looking at the earlier CL comments https://go-review.googlesource.com/c/go/+/40190/1/src/crypto/tls/tls.go#177 ; wouldn\u0027t it be cleaner to outdent the error translation like\n\n if err \u003d\u003d io.EOF {\n   err \u003d ....\n }\n if err !\u003d nil {\n   ...\n   return nil, err\n }\n\nI looked at the other errors in tls package briefly and for consistency the error should be brief. Maybe\n\n  tls: server closed connection in initial handshake\n\nFor consistency with other errors in crypto/tls, I would not include the address in the error. Without the address, the error should be errors.New(...).\n\nIt would be good to include a test to prevent regression. The playground link in the issue should help recreate the issue in test. For the test to be useful, it should use a closed connection, and not io.EOF.",
      "revId": "ecd30ed9b0724eb4bcf9b956976c5240cb1f4ec8",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "d79ce22e_8aa12338",
        "filename": "src/crypto/tls/tls.go",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 23250
      },
      "writtenOn": "2018-01-09T22:42:21Z",
      "side": 1,
      "message": "\u003eLooking at the earlier CL comments https://go-review.googlesource.com/c/go/+/40190/1/src/crypto/tls/tls.go#177 ; wouldn\u0027t it be cleaner to outdent the error translation like\n\nNope, the \"if err \u003d\u003d io.EOF\" block could not be before the \"if err !\u003d nil\" block because rawConn.Close must be called, I think. This change is different from the one pointed out by Brad\u0027s.\n\n\u003eFor consistency with other errors in crypto/tls, I would not include the address in the error. Without the address, the error should be errors.New(...).\n\nOkay, got it.\n\n\u003eIt would be good to include a test to prevent regression. The playground link in the issue should help recreate the issue in test. For the test to be useful, it should use a closed connection, and not io.EOF.\n\nGood catch. Thanks.",
      "parentUuid": "05510c6b_686b0d88",
      "revId": "ecd30ed9b0724eb4bcf9b956976c5240cb1f4ec8",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "5ab323ea_bc4a86c9",
        "filename": "src/crypto/tls/tls.go",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 14770
      },
      "writtenOn": "2018-01-10T06:26:51Z",
      "side": 1,
      "message": "You are correct rawConn.Close must be called.\n\nBut the err is a variable we can change as it will only be returned. So if we\nchange it before the if err !\u003d nil, the modified error will be returned, and\nthe connection will be closed by the err !\u003d nil branch.\n\nI guess this is a corollary of\nhttps://github.com/golang/go/wiki/CodeReviewComments#indent-error-flow",
      "parentUuid": "d79ce22e_8aa12338",
      "revId": "ecd30ed9b0724eb4bcf9b956976c5240cb1f4ec8",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9b7201b3_4e9f7e0a",
        "filename": "src/crypto/tls/tls.go",
        "patchSetId": 3
      },
      "lineNbr": 158,
      "author": {
        "id": 23250
      },
      "writtenOn": "2018-01-10T09:54:40Z",
      "side": 1,
      "message": "Ah got it. I didn\u0027t understand the thing correctly. Fixed.",
      "parentUuid": "5ab323ea_bc4a86c9",
      "revId": "ecd30ed9b0724eb4bcf9b956976c5240cb1f4ec8",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    }
  ]
}