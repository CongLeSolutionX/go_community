{
  "comments": [
    {
      "key": {
        "uuid": "e4716c77_315044fb",
        "filename": "src/runtime/mpagealloc.go",
        "patchSetId": 29
      },
      "lineNbr": 73,
      "author": {
        "id": 5200
      },
      "writtenOn": "2019-10-28T18:06:12Z",
      "side": 1,
      "message": "So these are summaries of the leaves of the tree?\nHigher up in the tree, these counts could be larger than 2^21, right?\n21 bits here can only cover 16GB of heap.\n\nIt isn\u0027t clear to me where the 21 comes from - how is it determined that 21 is all we need? Is that related to arena size? Maybe you should assert some math here?\n\nlogMallocChunkPages is only 9, so I would expect summaries of individual chunks to need only 9 bits per start/max/end.",
      "revId": "7c7d014eb4792f2f092c058461570522415048d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9300dff0_10ac1bf4",
        "filename": "src/runtime/mpagealloc.go",
        "patchSetId": 29
      },
      "lineNbr": 73,
      "author": {
        "id": 25391
      },
      "writtenOn": "2019-10-28T18:37:32Z",
      "side": 1,
      "message": "You\u0027re right, the root level only supports counts up to 21 bits, or 16 GiB of heap. The 21 comes from trying to pack the three values into a uint64.\n\nThe use of 21 is a (somewhat) artificial limitation imposed by the structure of a mallocSum. If we were to make a mallocSum look like\n\ntype mallocSum struct {\n  start, max, end uint32\n}\n\nthen we can trade the 2^21 limitation for a 2^32 limitation.\n\nThe reason we try to pack it is to save space in the radix tree, but to support larger heaps we may need to change this.\n\nsummaries of individual chunks indeed only need 9 bits, but the same mallocSum is used throughout the tree for consistency\u0027s sake.",
      "parentUuid": "e4716c77_315044fb",
      "revId": "7c7d014eb4792f2f092c058461570522415048d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    }
  ]
}