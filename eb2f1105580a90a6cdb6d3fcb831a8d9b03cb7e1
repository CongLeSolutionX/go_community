{
  "comments": [
    {
      "key": {
        "uuid": "100336c0_1b4f9fc5",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 734,
      "author": {
        "id": 5065
      },
      "writtenOn": "2015-04-30T16:11:53Z",
      "side": 1,
      "message": "Is that third condition really required?",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90fd66eb_f930f018",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 734,
      "author": {
        "id": 5440
      },
      "writtenOn": "2015-04-30T18:30:25Z",
      "side": 1,
      "message": "It\u0027s required in the sense that currently there are places within gc that perform value copies of Type objects, and so these cache-validity-checks are needed because the cache pointers will be copied too.  Without it, 6g spews tons of errors even compiling package runtime.\n\nI couldn\u0027t find an easy way to identify all of the places where gc copies Type values, and I\u0027m unsure how common an idiom that is, so this seemed like the safer solution.  If someone more familiar with gc\u0027s internals wants to promise me that it\u0027s rare and not likely to occur more in the future, I\u0027m happy to track down the relevant assignments and update them to not copy the cache pointers.",
      "parentUuid": "100336c0_1b4f9fc5",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "edb169f2_f1fee82f",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 734,
      "author": {
        "id": 5056
      },
      "writtenOn": "2015-05-15T15:32:33Z",
      "side": 1,
      "message": "This scares me. I\u0027d much rather you found these places and define that you\u0027re not allowed to modify the result of PtrTo or SliceOf.",
      "parentUuid": "90fd66eb_f930f018",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "0da4fdb8_9c8cc28a",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 734,
      "author": {
        "id": 5440
      },
      "writtenOn": "2015-05-15T17:13:57Z",
      "side": 1,
      "message": "To clarify, callers aren\u0027t modifying the results of PtrTo and SliceOf directly.  They\u0027re making copies of Type values, and then modifying the copies.\n\nThe \"t.SliceOf.Type \u003d\u003d t\" check here (and \"t.PtrTo.Type \u003d\u003d t\" check below) are to safeguard against things like:\n\n    var t *Type \u003d [...]\n    var tSlice *Type \u003d SliceOf(t)\n\n    var u *Type \u003d new(Type)\n    *u \u003d *t\n    u.[foo] \u003d [...]\n    var uSlice *Type \u003d SliceOf(u)\n\nThe \"*u \u003d *t\" assignment will also assign u.SliceOf \u003d t.SliceOf, but that means u.SliceOf will point at tSlice, which would be the wrong value to return for SliceOf(u).\n\nStill, I\u0027ll look into identifying code sites where this copy-on-write behavior is happening, and we can discuss how best to handle them.",
      "parentUuid": "edb169f2_f1fee82f",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "100336c0_3b52636b",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 1558,
      "author": {
        "id": 5065
      },
      "writtenOn": "2015-04-30T16:11:53Z",
      "side": 1,
      "message": "Is that second part really required?",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "90fd66eb_392378d5",
        "filename": "src/cmd/internal/gc/subr.go",
        "patchSetId": 1
      },
      "lineNbr": 1558,
      "author": {
        "id": 5440
      },
      "writtenOn": "2015-04-30T18:30:25Z",
      "side": 1,
      "message": "Same reason as for SliceOf above.",
      "parentUuid": "100336c0_3b52636b",
      "revId": "eb2f1105580a90a6cdb6d3fcb831a8d9b03cb7e1",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}