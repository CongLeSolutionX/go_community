{
  "comments": [
    {
      "key": {
        "uuid": "3feb209c_df41b666",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1371,
      "author": {
        "id": 5440
      },
      "writtenOn": "2017-10-25T21:37:57Z",
      "side": 1,
      "message": "I have a suspicion this flexibility is unnecessary, and we can just unconditionally ignore pointers to not-in-heap types. The only reason identifying pointer-containing types is interesting to the compiler is because it affects GC, but the entire point of not-in-heap types is knowing they\u0027re never relevant to GC.\n\nPut differently: my understanding is pointer-to-notinheap-type is no different from uintptr, except it allows *p and p.f as syntactic sugar.\n\nAm I overlooking anything?",
      "range": {
        "startLine": 1371,
        "startChar": 27,
        "endLine": 1371,
        "endChar": 42
      },
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "bc497704_94310e9a",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1371,
      "author": {
        "id": 5167
      },
      "writtenOn": "2017-10-25T23:40:59Z",
      "side": 1,
      "message": "You may indeed be right, though I\u0027m not positive. Haspointers is used in a lot of places, and many of them have nothing to do with write barriers. For example, it\u0027s used in assignment ordering and in escape analysis, I believe just to understand what the object graph can look like.",
      "parentUuid": "3feb209c_df41b666",
      "range": {
        "startLine": 1371,
        "startChar": 27,
        "endLine": 1371,
        "endChar": 42
      },
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "234c195f_66c5e68e",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1371,
      "author": {
        "id": 5440
      },
      "writtenOn": "2017-10-26T00:20:08Z",
      "side": 1,
      "message": "Looking over all the types.Haspointers calls, I\u0027m pretty sure this is true. Basically, rather than just omitting write barriers for *T pointer slots where T is a notinheap type, I think the compiler should start treating those slots as scalar.\n\nI\u0027m a little less confident about esc.go due to lack of familiarity with that code, but I didn\u0027t spot anything that seems problematic.\n\nThat said, I\u0027m leaning towards we should make this change separately, because I think there are other places we might need to change too. E.g., onebitwalktype1 should skip pointer-to-notinheap types.",
      "parentUuid": "bc497704_94310e9a",
      "range": {
        "startLine": 1371,
        "startChar": 27,
        "endLine": 1371,
        "endChar": 42
      },
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "5f3dcf33_5bd7533f",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1371,
      "author": {
        "id": 5167
      },
      "writtenOn": "2017-10-26T21:24:18Z",
      "side": 1,
      "message": "I\u0027ll add a TODO.",
      "parentUuid": "234c195f_66c5e68e",
      "range": {
        "startLine": 1371,
        "startChar": 27,
        "endLine": 1371,
        "endChar": 42
      },
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "971be1bc_a70a4184",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1392,
      "author": {
        "id": 5210
      },
      "writtenOn": "2017-10-26T00:05:01Z",
      "side": 1,
      "message": "return !(ignoreNotInHeap \u0026\u0026 t.Elem().NotInHeap())\n\n(assume the CL as a whole is correct)",
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a2b3e34e_f37842e1",
        "filename": "src/cmd/compile/internal/types/type.go",
        "patchSetId": 1
      },
      "lineNbr": 1392,
      "author": {
        "id": 5167
      },
      "writtenOn": "2017-10-26T21:24:18Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "971be1bc_a70a4184",
      "revId": "ab96e115d62f9ae05ce3676d4c1f1b8d09bb13d0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}