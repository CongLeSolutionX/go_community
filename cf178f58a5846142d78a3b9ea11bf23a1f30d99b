{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "5fec1e90_fc543e82",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2024-08-21T23:21:06Z",
      "side": 1,
      "message": "I\u0027m puzzled by this.  The implementations of syscall.Getwd don\u0027t work in deep directory trees.  But I have to admit that this code seems to be a correct translation of the existing code.  How is this working in general?  Is it just relying on the PWD environment variable?",
      "revId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "56936b23_8961ba87",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 34895
      },
      "writtenOn": "2024-08-21T23:53:18Z",
      "side": 1,
      "message": "Looking at the comments on the other CL, I think a good intermediate step is to fall back to the existing general algorithm if syscall.Getwd fails because the name is too long.",
      "parentUuid": "5fec1e90_fc543e82",
      "revId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82c1cf4a_deaba970",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 26451
      },
      "writtenOn": "2024-08-22T02:32:57Z",
      "side": 1,
      "message": "Currently the code being removed is not used at all:\n - all platforms have `syscall.ImplementsGetwd \u003d true`;\n - if `PWD` env var is used and it\u0027s longed than PATH_MAX, ENAMETOOLONG is returned from the stat call and it falls back to using `syscall.Getwd`;\n - if an error is returned from syscall.Getwd, it is returned (i.e. there\u0027s no fallback to the code being removed).\n\nIf such a fallback is to be implemented, the path returned is hardly usable for anything but logging, since all syscalls will return ENAMETOOLONG.\n\n(Not really related to this, but getcwd syscall on Linux can never return any path longer than PATH_MAX no matter what the buffer provided is).\n\nThe above is true for at least Linux, but I _think_ most other platforms work in a similar way, i.e. it doesn\u0027t make sense to return a longer path from os.Getwd which can\u0027t be used anyway.",
      "parentUuid": "56936b23_8961ba87",
      "revId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "15f232df_9624dcef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 26451
      },
      "writtenOn": "2024-08-22T02:43:16Z",
      "side": 1,
      "message": "I\u0027ve implemented the fallback and it works (see below). But I still don\u0027t think it makes sense to return a value which is\n - expensive to obtain;\n - error prone to obtain (some stat calls may fail due to permissions);\n - mostly useless.\n\nHere\u0027s the fallback diff:\n\n```diff\ndiff --git a/src/os/getwd.go b/src/os/getwd.go\nindex 732ece7b09..1e4b0a109a 100644\n--- a/src/os/getwd.go\n+++ b/src/os/getwd.go\n@@ -56,9 +56,13 @@ func Getwd() (dir string, err error) {\n                                break\n                        }\n                }\n+               if e \u003d\u003d syscall.ENAMETOOLONG {\n+                       goto slow\n+               }\n                return s, NewSyscallError(\"getwd\", e)\n        }\n \n+slow:\n        // Apply same kludge but to cached dir instead of $PWD.\n        getwdCache.Lock()\n        dir \u003d getwdCache.dir\n```\n\nHere\u0027s the test:\n\n```\n  func TestGetwdDeep(t *testing.T) {\n          dir :\u003d t.TempDir()\n          t.Chdir(dir)\n          \n          name :\u003d strings.Repeat(\"a\", 200)\n          for {\n                  if err :\u003d os.Mkdir(name, 0o700); err !\u003d nil {\n                          t.Fatal(err)\n                  }\n                  if err :\u003d os.Chdir(name); err !\u003d nil {\n                          t.Fatal(err)\n                  }\n  \n                  wd, err :\u003d os.Getwd()\n                  t.Logf(\"     os.Getwd len \u003d %d, err \u003d %v\", len(wd), err)\n                  if err !\u003d nil {\n                          t.Fatal(err)\n                  }\n                  if len(wd) \u003e syscall.PathMax {\n                          break\n                  }\n          }\n  }\n```\n\nHere\u0027s the result:\n\n```\n[kir@kir-tp1 src]$ go test -run GetwdDeep -v os \n\u003d\u003d\u003d RUN   TestGetwdDeep\n    getwd_test.go:69:      os.Getwd len \u003d 233, err \u003d \u003cnil\u003e\n    getwd_test.go:69:      os.Getwd len \u003d 434, err \u003d \u003cnil\u003e\n\u003c...skipped for clarity...\u003e\n    getwd_test.go:69:      os.Getwd len \u003d 4052, err \u003d \u003cnil\u003e\n    getwd_test.go:69:      os.Getwd len \u003d 4253, err \u003d \u003cnil\u003e\n--- PASS: TestGetwdDeep (0.00s)\n```",
      "parentUuid": "82c1cf4a_deaba970",
      "revId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e53c7f8a_16c0d579",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2024-08-22T16:59:11Z",
      "side": 1,
      "message": "My thinking is that os.Getwd should work.  It shouldn\u0027t be limited so that it doesn\u0027t work in directories with long names.  That restriction is just weird.\n\nIf we start from that assumption, then we already have the code we need to make it work (the stat problem we can handle in some other way).  I agree that we aren\u0027t using that code today.  But let\u0027s not discard it.  Instead, let\u0027s use it.",
      "parentUuid": "15f232df_9624dcef",
      "revId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ],
  "submitRequirementResults": [
    {
      "submitRequirement": {
        "name": "Code-Review",
        "description": {
          "value": "At least one Code-Review+2 is required. Self review is not allowed."
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "label:Code-Review\u003dMAX,user\u003dnon_uploader"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Code-Review=MAX,user=non_uploader"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Code-Review=MAX,user=non_uploader"]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Do-Not-Review",
        "description": {
          "value": "Changes that have DO NOT REVIEW in their commit message are not submittable."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (R|r)(E|e)(V|v)(I|i)(E|e)(W|w).*\""
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (R|r)(E|e)(V|v)(I|i)(E|e)(W|w).*\""},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (R|r)(E|e)(V|v)(I|i)(E|e)(W|w).*\""]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Do-Not-Submit",
        "description": {
          "value": "Changes that have DO NOT SUBMIT in their commit message are not submittable."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (S|s)(U|u)(B|b)(M|m)(I|i)(T|t).*\""
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (S|s)(U|u)(B|b)(M|m)(I|i)(T|t).*\""},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["message:\"^.*(D|d)(O|o) (N|n)(O|o)(T|t) (S|s)(U|u)(B|b)(M|m)(I|i)(T|t).*\""]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Legacy-TryBots-Pass",
        "description": {
          "value": "Legacy TryBots must pass if requested, unless TryBot-Bypass+1 is set."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "label:Run-TryBot\u003dMAX"
          }
        },
        "submittabilityExpression": {
          "expressionString": "label:TryBot-Result\u003dMAX"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:TryBot-Bypass\u003dMAX"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Run-TryBot=MAX"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Run-TryBot=MAX"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:TryBot-Result=MAX"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:TryBot-Bypass=MAX"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Matching-Subject-Prefix",
        "description": {
          "value": "Changes on release branches must have a matching [release-branch.go1.nn] subject prefix."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "branch:\"^refs/heads/release-branch.+\" -prefixsubject:\"[release-branch\""
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"branch:\"^refs/heads/release-branch.+\" -prefixsubject:\"[release-branch\""},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["branch:\"^refs/heads/release-branch.+\"","prefixsubject:\"[release-branch\""]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "No-Holds",
        "description": {
          "value": "Changes with a Hold+1 vote are not submittable."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "label:Hold\u003d1"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:Hold=1"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:Hold=1"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "No-Signed-off-by-Footer",
        "description": {
          "value": "Changes with a Signed-off-by footer are not submittable. See https://go.dev/wiki/CommitMessage."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "hasfooter:Signed-off-by"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"hasfooter:Signed-off-by"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["hasfooter:Signed-off-by"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "No-Unresolved-Comments",
        "description": {
          "value": "Changes that have unresolved comments are not submittable, unless overriden by adding the hashtag allow-unresolved-comments."
        },
        "applicabilityExpression": {},
        "submittabilityExpression": {
          "expressionString": "-has:unresolved"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "hashtag:allow-unresolved-comments"
          }
        },
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {},
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"-has:unresolved"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":["has:unresolved"],"failingAtoms":[]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"hashtag:allow-unresolved-comments"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["hashtag:allow-unresolved-comments"]}
      },
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "No-Wait-Release",
        "description": {
          "value": "Changes with the hashtag wait-release cannot be submitted."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "hashtag:wait-release"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:false"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"hashtag:wait-release"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["hashtag:wait-release"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:false"},"status":"NOT_EVALUATED","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":[]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "Review-Enforcement",
        "description": {
          "value": "Two Google employees must approve the change. Uploading the change or voting positively on Code-Review count as approval. Using a trusted device is required, see go/gerrit-onboarding#review-enforcement."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "is:review-enforced_gerrit"
          }
        },
        "submittabilityExpression": {
          "expressionString": "is:review-enforcement-satisfied_gerrit"
        },
        "overrideExpression": {},
        "allowOverrideInChildProjects": false
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforced_gerrit"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":["is:review-enforced_gerrit"],"failingAtoms":[]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"is:review-enforcement-satisfied_gerrit"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["is:review-enforcement-satisfied_gerrit"]}
      },
      "overrideExpressionResult": {},
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    },
    {
      "submitRequirement": {
        "name": "TryBots-Pass",
        "description": {
          "value": "Changes must pass LUCI TryBots unless TryBot-Bypass+1 is set. Vote Commit-Queue+1 to trigger TryBots."
        },
        "applicabilityExpression": {
          "value": {
            "expressionString": "-branch:refs/meta/config"
          }
        },
        "submittabilityExpression": {
          "expressionString": "label:LUCI-TryBot-Result\u003dMAX"
        },
        "overrideExpression": {
          "value": {
            "expressionString": "label:TryBot-Bypass\u003dMAX"
          }
        },
        "allowOverrideInChildProjects": true
      },
      "applicabilityExpressionResult": {
        "value": {"expression":{"expressionString":"-branch:refs/meta/config"},"status":"PASS","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["branch:refs/meta/config"]}
      },
      "submittabilityExpressionResult": {
        "value": {"expression":{"expressionString":"label:LUCI-TryBot-Result=MAX"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:LUCI-TryBot-Result=MAX"]}
      },
      "overrideExpressionResult": {
        "value": {"expression":{"expressionString":"label:TryBot-Bypass=MAX"},"status":"FAIL","errorMessage":{"value":null},"passingAtoms":[],"failingAtoms":["label:TryBot-Bypass=MAX"]}
      },
      "patchSetCommitId": "cf178f58a5846142d78a3b9ea11bf23a1f30d99b",
      "legacy": {
        "value": false
      },
      "forced": {},
      "hidden": {}
    }
  ]
}