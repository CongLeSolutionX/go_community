{
  "comments": [
    {
      "key": {
        "uuid": "e92ae225_e19a0bd7",
        "filename": "src/crypto/tls/conn.go",
        "patchSetId": 4
      },
      "lineNbr": 1411,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-07T05:25:56Z",
      "side": 1,
      "message": "I\u0027d either move ConnectionState down or this up so they are one after the other.",
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1942aef5_c72a24e2",
        "filename": "src/crypto/tls/conn.go",
        "patchSetId": 4
      },
      "lineNbr": 1411,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-07T23:56:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "e92ae225_e19a0bd7",
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "bf43758e_a28b26f3",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 794,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-07T05:25:56Z",
      "side": 1,
      "message": "This function is not called on resumed connections (see the first condition in readServerCertificate for TLS 1.3, and note it\u0027s only called by doFullHandshake for TLS 1.2).\n\nThis is https://github.com/golang/go/issues/31641 where we reverify the certificates on the server side but not on the client side. VerifyConnection should run on all connections, so we don\u0027t need to decide that now.",
      "range": {
        "startLine": 794,
        "startChar": 15,
        "endLine": 794,
        "endChar": 38
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "81a244da_dbb8d916",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 794,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-07T23:56:10Z",
      "side": 1,
      "message": "Just to clarify this comment, are you suggesting that I need to explicitly add a call to VerifyConnection in TLS1.3 readServerCertificate() and (*clientHandshakeState).handshake() since they would otherwise not be called in resumed connections?",
      "parentUuid": "bf43758e_a28b26f3",
      "range": {
        "startLine": 794,
        "startChar": 15,
        "endLine": 794,
        "endChar": 38
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a68d5c13_2c905b8b",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 794,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-08T00:13:31Z",
      "side": 1,
      "message": "Yes, haven\u0027t thought through where the call should be, but there should be one for every connection, including resumed connections.",
      "parentUuid": "81a244da_dbb8d916",
      "range": {
        "startLine": 794,
        "startChar": 15,
        "endLine": 794,
        "endChar": 38
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "1c23ab62_e364c40a",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 794,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-08T00:52:18Z",
      "side": 1,
      "message": "Added it in the renegotiation handshake section of (*clientHandshakeState).handshake(). It will at the very least contain the ocspResponse from what I can see. LMK if you think that\u0027s the wrong spot.",
      "parentUuid": "a68d5c13_2c905b8b",
      "range": {
        "startLine": 794,
        "startChar": 15,
        "endLine": 794,
        "endChar": 38
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "1dc12dfb_61b9a7e8",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 794,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-08T01:19:40Z",
      "side": 1,
      "message": "Still needs fixing for resumed TLS 1.3 connections. (And see my other comment for the TLS 1.2 part being in the wrong spot.)",
      "parentUuid": "1c23ab62_e364c40a",
      "range": {
        "startLine": 794,
        "startChar": 15,
        "endLine": 794,
        "endChar": 38
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "3705939b_dc7600bc",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 838,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-07T05:25:56Z",
      "side": 1,
      "message": "Just for consistency, let\u0027s move this above the VerifyPeerCertificate call. Nothing the callback can do if the key is not supported anyway.",
      "range": {
        "startLine": 830,
        "startChar": 0,
        "endLine": 838,
        "endChar": 27
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2ccbb7a_836bedd3",
        "filename": "src/crypto/tls/handshake_client.go",
        "patchSetId": 4
      },
      "lineNbr": 838,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-07T23:56:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3705939b_dc7600bc",
      "range": {
        "startLine": 830,
        "startChar": 0,
        "endLine": 838,
        "endChar": 27
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "df015c13_a98decfd",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 732,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-07T05:25:56Z",
      "side": 1,
      "message": "This function is not called if the server didn\u0027t request client certificates, so VerifyConnection wouldn\u0027t run on those connections.",
      "range": {
        "startLine": 732,
        "startChar": 15,
        "endLine": 732,
        "endChar": 37
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9c807efb_16e4cf27",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 732,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-07T23:56:10Z",
      "side": 1,
      "message": "Same question here as your other comment, are you saying that we *should* be calling VerifyConnection in that case, so I should add an explicit call to VerifyConnection in (*serverHandshakeState).doFullHandshake() in the case of the server not requesting client certificates?",
      "parentUuid": "df015c13_a98decfd",
      "range": {
        "startLine": 732,
        "startChar": 15,
        "endLine": 732,
        "endChar": 37
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0411b904_66362cdb",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 732,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-08T00:13:31Z",
      "side": 1,
      "message": "Yes, same, not sure where but there should be one.",
      "parentUuid": "9c807efb_16e4cf27",
      "range": {
        "startLine": 732,
        "startChar": 15,
        "endLine": 732,
        "endChar": 37
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "2b76b940_a2f6aaa5",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 732,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-08T00:52:18Z",
      "side": 1,
      "message": "Put it (*serverHandshakeState).doFullHandshake() as an else. That should work but LMK if you think there\u0027s a better spot for it.",
      "parentUuid": "0411b904_66362cdb",
      "range": {
        "startLine": 732,
        "startChar": 15,
        "endLine": 732,
        "endChar": 37
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "75e2d4c8_b912abc9",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 732,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-08T01:19:40Z",
      "side": 1,
      "message": "That does it for TLS 1.2 but not for TLS 1.3.\n\n(also, huh, found a bug because I was surprised processCertsFromClient always runs for resumed handshakes: https://github.com/golang/go/issues/31641#issuecomment-625575938)",
      "parentUuid": "2b76b940_a2f6aaa5",
      "range": {
        "startLine": 732,
        "startChar": 15,
        "endLine": 732,
        "endChar": 37
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6b6afeaf_cd8db2a9",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 796,
      "author": {
        "id": 11715
      },
      "writtenOn": "2020-05-07T05:25:56Z",
      "side": 1,
      "message": "For consistency, let\u0027s move this above the callbacks (behind a if len(certs) \u003e 0).",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 796,
        "endChar": 2
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "02f6dfe1_d3521083",
        "filename": "src/crypto/tls/handshake_server.go",
        "patchSetId": 4
      },
      "lineNbr": 796,
      "author": {
        "id": 28759
      },
      "writtenOn": "2020-05-07T23:56:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "6b6afeaf_cd8db2a9",
      "range": {
        "startLine": 790,
        "startChar": 0,
        "endLine": 796,
        "endChar": 2
      },
      "revId": "e473ca453bf510acf33aa07704c28cc112d602b0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}