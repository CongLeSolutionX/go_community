{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "53c7df62_d7cb563a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 16585
      },
      "writtenOn": "2023-11-10T06:22:05Z",
      "side": 1,
      "message": "TRY",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5c2ba49_d0100a0f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2023-11-10T06:22:21Z",
      "side": 1,
      "message": "TryBots beginning. Status page: https://farmer.golang.org/try?commit\u003d74a559d5\n",
      "tag": "autogenerated:trybots~beginning",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "06daca91_413d6fba",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2023-11-10T06:34:40Z",
      "side": 1,
      "message": "TryBots are happy.\n\n",
      "parentUuid": "e5c2ba49_d0100a0f",
      "tag": "autogenerated:trybots~happy",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b6f35501_2ed503ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 16585
      },
      "writtenOn": "2023-11-10T06:50:58Z",
      "side": 1,
      "message": "I intend to add a builder with wasmtime 14 and upgrade the current builder to wasmtime 13. Perhaps we should hold this until those are merged?",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1642be63_f249d652",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6005
      },
      "writtenOn": "2023-11-10T16:47:56Z",
      "side": 1,
      "message": "We already have a builder with wasmtime 14 (tracked in #61116) in the new build infrastructure that we\u0027re moving to. It\u0027s triggered via the Commit-Queue+1 vote. See [Please switch to LUCI for basic presubmit testing](https://groups.google.com/g/golang-dev/c/H65LelTvAXQ), https://go.dev/wiki/GerritAccess#running-trybots-may-start-trybots, and https://go.dev/wiki/LUCI#TryBots for more context.\n\nIt\u0027s reporting that this change is causing a few tests to start failing (see the Checks tab), though I don\u0027t see what might be causing thatâ€”the new CLI usage seems right at a glance. Other than that, this change looks good and I\u0027ll review after you figure out the failure.",
      "parentUuid": "b6f35501_2ed503ed",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "6e3b0040_11615cee",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 16585
      },
      "writtenOn": "2023-11-11T04:54:35Z",
      "side": 1,
      "message": "I looked at some of the test failures and the only ones I could easily run on my own machine were crypto/tls.TestConnReadNonzeroAndEOF and encoding/go.TestCountDecodeMallocs, both if which are also failing for me locally on master. Do the runners succeed on master?\n\nThe command I\u0027m using is\n\nGOOS\u003dwasip1 GOARCH\u003dwasm PATH\u003d$PATH:$(pwd)/../misc/wasm TMPDIR\u003d$(pwd)/tmp ../bin/go test -run \u0027TestCountDecodeMallocs\u0027 ./encoding/gob\n\nand\n\nGOOS\u003dwasip1 GOARCH\u003dwasm PATH\u003d$PATH:$(pwd)/../misc/wasm TMPDIR\u003d$(pwd)/tmp ../bin/go test -run \u0027TestConnReadNonzeroAndEOF\u0027 ./crypto/tls",
      "parentUuid": "1642be63_f249d652",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1553a840_a3296a45",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 6005
      },
      "writtenOn": "2023-11-13T16:14:37Z",
      "side": 1,
      "message": "\u003e Do the runners succeed on master?\n\nYes, see the wasip1 columns at https://ci.chromium.org/p/golang/g/go-gotip/console. (If you ever forget the LUCI post-submit dashboard link, it\u0027s mentioned at the top of https://go.dev/wiki/LUCI.)\n\nIt was a good idea to check; I quickly saw that the problem was that these tests were [being skipped](https://ci.chromium.org/ui/p/golang/builders/ci/gotip-wasip1-wasm_wasmtime/b8764535432404663409/test-results?sortby\u003d\u0026groupby\u003d\u0026q\u003dTestCountDecodeMallocs+) at tip, which is [intended behavior](https://cs.opensource.google/go/go/+/master:src/encoding/gob/timing_test.go;l\u003d103-105;drc\u003d56e900d9f0da967d9152c546db1684653a69ece5) given it\u0027s not a longtest builder, so the bug was that they were running at all with this change, not that they were failing. See my other inline comment for details.\n\n\u003e the only ones I could easily run on my own machine were crypto/tls.TestConnReadNonzeroAndEOF and encoding/go.TestCountDecodeMallocs\n\nFor reference, you should be able to run the GOROOT/test test cases with something like:\n\n```\n$ PATH\u003d$PATH:$(pwd)/../misc/wasm TMPDIR\u003d$(pwd)/tmp ../bin/go test -run\u003d\u0027^Test/args.go$\u0027 cmd/internal/testdir -target\u003dwasip1/wasm\n```\n\n(As written down [here](https://github.com/golang/go/blob/master/test/README.md).)\n\nOr via cmd/dist\u0027s test subcommand, an intermediate abstraction layer that all.bash goes through:\n\n```\n$ GOOS\u003dwasip1 GOARCH\u003dwasm PATH\u003d$PATH:$(pwd)/../misc/wasm TMPDIR\u003d$(pwd)/tmp ../bin/go tool dist test -v -run\u003d\u0027cmd/internal/testdir:0_1\u0027\n```\n\nAlthough it\u0027s tricky because the invocation might\u0027ve been broken by the bad argument passing.\n\nIt\u0027s interesting to see just how few tests broke as a result of argument parsing being broken. But it\u0027s good the \u0027Test/args.go\u0027 test exists to test exactly this. I left another inline comment closer to the problem, so marking this as resolved.",
      "parentUuid": "6e3b0040_11615cee",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "7b9af5f6_d77560c8",
        "filename": "misc/wasm/go_wasip1_wasm_exec",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 6005
      },
      "writtenOn": "2023-11-10T16:58:10Z",
      "side": 1,
      "message": "Another possible way of resolving #63718, that I\u0027m not sure if it was brought up in the issue, would be by introducing a new \"wasmtime14\" GOWASIRUNTIME value for Wasmtime 14+, and letting the current \"wasmtime\" one be for Wasmtime 13 and older. That could resolve the ambiguity of GOWASIRUNTIMEARGS.\n\nI just wanted to point out the possibility. I\u0027m not suggesting it\u0027s worth pursuing at this time: the overhead of supporting an additional GOWASIRUNTIME value seems a bit much for it to be worthwhile doing over a CLI change. But it might be useful in another situation in the future.",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e2d21541_0f0c27b1",
        "filename": "misc/wasm/go_wasip1_wasm_exec",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 16585
      },
      "writtenOn": "2023-11-11T04:54:35Z",
      "side": 1,
      "message": "Fair point, but I don\u0027t think we need to add that complexity here - for almost all users this will \"just work\" and users with more advanced needs can just write their own scripts. We\u0027ll remove this and only support wasmtime 14+ once the tree opens after the freeze.",
      "parentUuid": "7b9af5f6_d77560c8",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4fe793f0_6e1ea687",
        "filename": "misc/wasm/go_wasip1_wasm_exec",
        "patchSetId": 1
      },
      "lineNbr": 16,
      "author": {
        "id": 6005
      },
      "writtenOn": "2023-11-13T16:14:37Z",
      "side": 1,
      "message": "Agreed.",
      "parentUuid": "e2d21541_0f0c27b1",
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f734027e_433f1a2b",
        "filename": "misc/wasm/go_wasip1_wasm_exec",
        "patchSetId": 1
      },
      "lineNbr": 24,
      "author": {
        "id": 6005
      },
      "writtenOn": "2023-11-13T16:14:37Z",
      "side": 1,
      "message": "The -- had the intended effect for the previous CLI, but needs updating for the new CLI:\n\n```\n$ cat /tmp/a.go\npackage main\n\nimport (\"fmt\"; \"os\")\n\nfunc main() {\n\tfmt.Printf(\"args: %q\\n\", os.Args)\n}\n\n# at Go tip\n$ GOOS\u003dwasip1 GOARCH\u003dwasm go run /tmp/a.go -short\u003dtrue\nargs: [\"a\" \"-short\u003dtrue\"]\n\n# this CL\n$ GOOS\u003dwasip1 GOARCH\u003dwasm go run /tmp/a.go -short\u003dtrue\nargs: [\"a\" \"--\" \"-short\u003dtrue\"]\n```",
      "range": {
        "startLine": 24,
        "startChar": 119,
        "endLine": 24,
        "endChar": 121
      },
      "revId": "74a559d5ca1005a69c08cd51abfb3b52a182f62a",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}