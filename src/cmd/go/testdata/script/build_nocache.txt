env GOCACHE=
env XDG_CACHE_HOME=
env HOME=
[plan9] env home=
[windows] env LocalAppData=
! go build -o triv triv.go
stderr 'build cache is required, but could not be located: GOCACHE is not defined and .* defined'

# An explicit GOCACHE=off is definitely not OK.
env GOCACHE=off
! go build -o triv triv.go
stderr 'build cache is disabled by GOCACHE=off'

# Set GOCACHE to a directory that doesn't allow writes.
[windows] skip # Does not support unwritable directories.
[root] skip # Can write to unwritable directories.

mkdir $WORK/unwritable/home
chmod 0555 $WORK/unwritable/home
[!plan9] env HOME=$WORK/unwritable/home
[plan9] env home=$WORK/unwritable/home

# As of Go 1.12, the module cache is required:
# failure to write to it should cause builds to fail.
env GOCACHE=$WORK/unwritable/home
! go build -o triv triv.go
stderr 'failed to initialize build cache.* permission denied'

-- triv.go --
package main
func main() {}
