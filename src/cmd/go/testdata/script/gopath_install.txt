# Regression test for 'go install' locations in GOPATH mode.
env GO111MODULE=off
[short] skip

# Without $GOBIN set, binary packages should be installed into GOPATH[0]/bin.
env GOBIN=
go env GOBIN
stdout 'gopath[/\\]bin$'
go install go-cmd-test
exists $GOPATH/bin/go-cmd-test$GOEXE
go install $WORK/outside.go
exists $GOPATH/bin/outside$GOEXE

# With $GOBIN set, binaries should be installed to $GOBIN.
env GOBIN=$WORK/bin1
go env GOBIN
stdout 'bin1$'
go install go-cmd-test
exists $GOBIN/go-cmd-test$GOEXE
go install $WORK/outside.go
exists $GOBIN/outside$GOEXE
rm $WORK/bin1

# Issue 11065: installing to the current directory should create an executable.
cd go-cmd-test
env GOBIN=$PWD
go install
exists ./go-cmd-test$GOEXE
cd ..

# Without $GOBIN, $GOPATH, or $HOME set, installing a program outside $GOPATH
# should fail (there is nowhere to install it).
[!windows] [!plan9] env HOME=
[windows] env USERPROFILE=
[plan9] env home=
env GOPATH=
env GOBIN=
! go install go-cmd-test/helloworld.go
stderr '^go install: no install location for \.go files listed on command line \(GOBIN not set\)$'

# With $GOBIN set, should install there.
env GOBIN=$WORK/bin1
go install go-cmd-test/helloworld.go
exists $GOBIN/helloworld$GOEXE
rm $WORK/bin1

# We can't assume that we can write to GOROOT, because it may not be writable.
# However, we can check its install location using 'go list'.
# cmd/fix should be installed to GOROOT/pkg, not GOPATH/bin.
env GOPATH=$PWD
go list -f '{{.Target}}' cmd/fix
stdout $GOROOT'[/\\]pkg[/\\]tool[/\\]'$GOOS'_'$GOARCH'[/\\]fix'$GOEXE'$'

# GOBIN should not affect toolchain install locations.
env GOBIN=$WORK/bin1
go list -f '{{.Target}}' cmd/fix
stdout $GOROOT'[/\\]pkg[/\\]tool[/\\]'$GOOS'_'$GOARCH'[/\\]fix'$GOEXE'$'

-- go-cmd-test/helloworld.go --
package main

func main() {
	println("hello world")
}

-- $WORK/outside.go --
package main

func main() {
	println("outside GOPATH")
}
