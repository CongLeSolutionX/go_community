# Set up fresh GOCACHE.
env GOCACHE=$WORK/gocache
mkdir $GOCACHE

# Building trivial non-main package should run compiler the first time.
go build -x lib.go
stderr '(compile|gccgo) .*lib\.go'

# ... but not again ...
go build -x lib.go
! stderr '(compile|gccgo) .*lib\.go'

# ... unless we use -a.
go build -a -x lib.go
stderr '(compile|gccgo) '

-- lib.go --
package lib
