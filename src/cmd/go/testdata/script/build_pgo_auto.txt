# Test go build -pgo=auto flag.

# use default.pgo for a single main package
go build -n -pgo=auto ./a/a1
stderr 'compile.*-pgoprofile=.*default\.pgo.*a1.go'

# use default.pgo for ... with a single main package
go build -n -pgo=auto ./a/...
stderr 'compile.*-pgoprofile=.*default\.pgo.*a1.go'

# error with multiple packages
! go build -n -pgo=auto ./b/...
stderr '-pgo=auto requires exactly one main package'

# build succeeds without PGO when default.pgo file is absent
go build -n -pgo=auto -o nopgo.exe ./nopgo
stderr 'compile.*nopgo.go'
! stderr '-pgoprofile'

-- go.mod --
module test
go 1.20
-- a/a1/a1.go --
package main
func main() {}
-- a/a1/default.pgo --
-- b/b1/b1.go --
package main
func main() {}
-- b/b1/default.pgo --
-- b/b2/b2.go --
package main
func main() {}
-- b/b2/default.pgo --
-- nopgo/nopgo.go --
package main
func main() {}
