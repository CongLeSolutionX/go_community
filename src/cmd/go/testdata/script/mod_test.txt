env GO111MODULE=on

# list -deps should not show testing.
cd a/
cp go.mod.empty go.mod
go list -deps
! stdout ^testing$

# list all should include test dependencies, like testing
cp go.mod.empty go.mod
go list all
stdout ^testing$
stdout ^rsc.io/quote$
stdout ^rsc.io/testonly$

# list -deps -tests should also include testing
# but not deps of tests of deps (rsc.io/testonly).
go list -deps -test
stdout ^testing$
stdout ^rsc.io/quote$
! stdout ^rsc.io/testonly$

# list -test all should succeed
cp go.mod.empty go.mod
go list -test all
stdout '^testing'

cp go.mod.empty go.mod
go test
stdout PASS

-- a/go.mod.empty --
module github.com/user/a

-- a/a.go --
package a

-- a/a_test.go --
package a

import (
	"testing"
	_ "rsc.io/quote"
)

func Test(t *testing.T) {}
