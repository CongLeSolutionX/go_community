// Copyright 2022 The Go Authors. All rights reserved.
// Use of this source code is governed by a BSD-style
// license that can be found in the LICENSE file.

// This file contains rules used by laterLower to
// split a constant folding op with large constant into
// a move and op.
// These are often the exact inverse of rules in ARM64.rules.

(ADDconst [c] x) && !isaddcon(c)  => (ADD x (MOVDconst [c]))
(SUBconst [c] x) && !isaddcon(c)  => (SUB x (MOVDconst [c]))
(ANDconst [c] x) && !isbitcon(uint64(c)) => (AND x (MOVDconst [c]))
(ORconst  [c] x) && !isbitcon(uint64(c))  => (OR  x (MOVDconst [c]))
(XORconst [c] x) && !isbitcon(uint64(c))  => (XOR x (MOVDconst [c]))
(TSTconst [c] x) && !isbitcon(uint64(c))  => (TST x (MOVDconst [c]))
(TSTWconst [c] x) && !isbitcon(uint64(c)|uint64(c)<<32)  => (TSTW x (MOVDconst [int64(c)]))

(CMPconst [c] x) && !isaddcon(c)  => (CMP x (MOVDconst [c]))
(CMPWconst [c] x) && !isaddcon(int64(c))  => (CMPW x (MOVDconst [int64(c)]))
(CMNconst [c] x) && !isaddcon(c)  => (CMN x (MOVDconst [c]))
(CMNWconst [c] x) && !isaddcon(int64(c))  => (CMNW x (MOVDconst [int64(c)]))

(InvertFlags (CMPconst [c] x)) && !isaddcon(c)  => (CMP (MOVDconst [c]) x)
(InvertFlags (CMPWconst [c] x)) && !isaddcon(int64(c))  => (CMPW (MOVDconst [int64(c)]) x)

(ADDSconstflags [c] x) && !isaddcon(c)  => (ADDSflags x (MOVDconst [c]))