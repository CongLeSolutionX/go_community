{
  "comments": [
    {
      "key": {
        "uuid": "d7a2c67b_e6fab750",
        "filename": "src/database/sql/sql.go",
        "patchSetId": 1
      },
      "lineNbr": 1397,
      "author": {
        "id": 5065
      },
      "writtenOn": "2016-12-27T16:49:04Z",
      "side": 1,
      "message": "this has gotten a little complex. I wonder if it\u0027s time for a mutex and more explicitly-named state fields.\n\nIf you prefer to keep this for now, that\u0027s okay, but please add a test, and maybe a bit more doc here, saying what close means. (\"when the close method is called via Foo, Bar, or baz condition\").\n\nThis raises the question of why it doesn\u0027t just go from 0 to 2, or why more work isn\u0027t just done in the 0 to 1 transition.",
      "revId": "dc340e89877956f12dba786203048af99229fc00",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "570a565e_8f1c75de",
        "filename": "src/database/sql/sql.go",
        "patchSetId": 1
      },
      "lineNbr": 1426,
      "author": {
        "id": 5025
      },
      "writtenOn": "2016-12-26T23:56:29Z",
      "side": 1,
      "message": "I\u0027m not sure but I wonder this might be flaky when calling close twice? ex: 1,2,1",
      "revId": "dc340e89877956f12dba786203048af99229fc00",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d7a2c67b_533b4b2a",
        "filename": "src/database/sql/sql.go",
        "patchSetId": 1
      },
      "lineNbr": 1426,
      "author": {
        "id": 5080
      },
      "writtenOn": "2016-12-27T00:59:18Z",
      "side": 1,
      "message": "Because the other calls call compare and swap from 0 to 1, and this calls from 1 to 2, it can never go backwards or be repeated.\n\nThe main issue is that the tx.done wasn\u0027t getting set on rollback and commit, but in close. tx.close is only called from rollback and commit. As such, the compare and swap in tx.close is strictly not needed and maybe should be removed now that commit and rollback do the cas.",
      "parentUuid": "570a565e_8f1c75de",
      "revId": "dc340e89877956f12dba786203048af99229fc00",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "570a565e_ef34213b",
        "filename": "src/database/sql/sql.go",
        "patchSetId": 1
      },
      "lineNbr": 1426,
      "author": {
        "id": 5025
      },
      "writtenOn": "2016-12-27T16:44:11Z",
      "side": 1,
      "message": "Sorry, I misunderstand CompareAndSwapIntT. Seems good to me.",
      "parentUuid": "d7a2c67b_533b4b2a",
      "revId": "dc340e89877956f12dba786203048af99229fc00",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}