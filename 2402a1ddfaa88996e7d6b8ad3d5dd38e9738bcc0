{
  "comments": [
    {
      "key": {
        "uuid": "ad213187_74d33655",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 160,
      "author": {
        "id": 5045
      },
      "writtenOn": "2015-06-01T04:13:16Z",
      "side": 1,
      "message": "This is not correct (sorry, my sample was off in this regard too); this will be iterating over UTF-8-encoded runes, not bytes, making the check on the next line ill-defined. This needs to be\n\nfor i :\u003d 0; i \u003c len(local); i++ {\n  ch :\u003d local[i]\n  ...",
      "range": {
        "startLine": 160,
        "startChar": 1,
        "endLine": 160,
        "endChar": 25
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad213187_d4da2a64",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 5045
      },
      "writtenOn": "2015-06-01T04:13:16Z",
      "side": 1,
      "message": "I\u0027m not sure this is correct to do here; shouldn\u0027t consumeAtom be checking this instead? RFC 5322 implies that, for instance, double dots are valid in the local part (it just insists that they be in a quoted string if they are present; sec 3.4.1).",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d9fb8c32_9388ee2b",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 7490
      },
      "writtenOn": "2015-06-03T17:57:14Z",
      "side": 1,
      "message": "It is correct following RFC 5322, moving it to consumeAtom makes it interfere with the parsing of names in an email address. So I\u0027m gonna leave it, because else a lot of rewrite would be needed.",
      "parentUuid": "ad213187_d4da2a64",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "99abd4ef_3b3a63d6",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 5045
      },
      "writtenOn": "2015-06-17T03:33:36Z",
      "side": 1,
      "message": "This code is parsing local-part as dot-atom. RFC 5322 3.4.1 says this:\n\n\"\"\"\nIf the [local-part] can be represented as a dot-atom (that is, it contains no characters other than atext characters or \".\" surrounded by atext characters), then the dot-atom form SHOULD be used and the quoted-string form SHOULD NOT be used.\n\"\"\"\n\nThat is saying that dot-atom is defined in such a way that \"..\" is not legal (and leading/trailing dots are not okay either). That means that consumeAtom should be the one enforcing that (when its dot arg is true).",
      "parentUuid": "d9fb8c32_9388ee2b",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "799460c1_cfe2ad15",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 7490
      },
      "writtenOn": "2015-06-17T17:24:02Z",
      "side": 1,
      "message": "Yes you\u0027re right, but where do I violate the RFC here? I understand that it would be \"nicer\"/\"more appropriate\" to put the code that checks all of that inside the `consumeAtom`. But this interferes with code for parsing the name before an address. But right now I am too busy to look into it right now.\n\nCheck line 310, which actually checks whether it is a quoted string or not. So if it is a quoted string `consumeQuotedString` is used which doesn\u0027t care about the dots. Else however we consume it first as a dot atom, and then I do the additional check for the double dots etc.\n\nI can take a look into it, but not for the first weeks, have other things to tackle first...",
      "parentUuid": "99abd4ef_3b3a63d6",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "9e665a35_140a5491",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 5045
      },
      "writtenOn": "2015-06-22T04:45:42Z",
      "side": 1,
      "message": "You\u0027re scattering code that should be centralised, making this harder to maintain in the long term. This highlighted code is enforcing a restriction on dot-atom, which is the responsibility of the consumeAtom method.",
      "parentUuid": "799460c1_cfe2ad15",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "dec53225_779ea2e9",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 325,
      "author": {
        "id": 7490
      },
      "writtenOn": "2015-06-22T18:22:32Z",
      "side": 1,
      "message": "You\u0027re completely right, I have examined why adding it to `consumeAtom` breaks existing tests:\n\nIssue #4938 allows an un-quoted  `phrase` in `display-name` to have a trailing dot. And `consumePhrase` method uses the `consumeAtom` function. So checking on the trailing/starting dot on a `dot-atom` fixes everything for the `local-part` of the address, but breaks a unit tests for an invalid `display-name`.\n\nHow do you suggest I fix this?\nAdding a parameter to the `consumeAtom` which sets whether the function should be persmissive or not? Or how should I fix this?",
      "parentUuid": "9e665a35_140a5491",
      "range": {
        "startLine": 320,
        "startChar": 0,
        "endLine": 325,
        "endChar": 4
      },
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "ad213187_94e0b216",
        "filename": "src/net/mail/message.go",
        "patchSetId": 3
      },
      "lineNbr": 491,
      "author": {
        "id": 5045
      },
      "writtenOn": "2015-06-01T04:13:16Z",
      "side": 1,
      "message": "This is too descriptive of the place it is used above.\n\n// quoteString renders a string as a RFC5322 quoted-string.",
      "revId": "2402a1ddfaa88996e7d6b8ad3d5dd38e9738bcc0",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}