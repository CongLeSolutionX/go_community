{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "edf0619d_daec236f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5400
      },
      "writtenOn": "2022-01-13T13:23:27Z",
      "side": 1,
      "message": "DW_AT_data_bit_offset is subtly different from DW_AT_bit_offset and I don\u0027t see how it\u0027s possible to recover actual meaning after it\u0027s blended into Go\u0027s StructField.BitOffset.\n\nDW_AT_bit_offset defines bit offset from beginning of the bitfield storage unit + actually in big-endian sense (offset of the end of bitfield from the end of the unit).\n\nWhile DW_AT_data_bit_offset is offset from the beginning of the whole outer struct + in little endian-sense.\n\nFor the following struct:\n\nstruct cdrom_tocentry\n{\n\tchar\tcdte_track;\n\tchar\tcdte_adr\t:4;\n\tchar\tcdte_ctrl\t:4;\n\tchar\tcdte_format;\n};\n\nI see with -gdwarf-3:\n\n{Name:cdte_track Type:char ByteOffset:0 ByteSize:0 BitOffset:0 BitSize:0}\n{Name:cdte_adr Type:char ByteOffset:1 ByteSize:1 BitOffset:4 BitSize:4}\n{Name:cdte_ctrl Type:char ByteOffset:1 ByteSize:1 BitOffset:0 BitSize:4}\n{Name:cdte_format Type:char ByteOffset:2 ByteSize:0 BitOffset:0 BitSize:0}\n\nwith -gswarf-5:\n\n\u0026{Name:cdte_track Type:char ByteOffset:0 ByteSize:0 BitOffset:0 BitSize:0}\n\u0026{Name:cdte_adr Type:char ByteOffset:0 ByteSize:0 BitOffset:8 BitSize:4}\n\u0026{Name:cdte_ctrl Type:char ByteOffset:0 ByteSize:0 BitOffset:12 BitSize:4}\n\u0026{Name:cdte_format Type:char ByteOffset:2 ByteSize:0 BitOffset:0 BitSize:0}\n\nFor larger types BitOffset can be hundreds and thousands (offset from beginning of the struct).\n\nI don\u0027t see how Go package users can treat both of them.\n\n+ the following comment become wrong:\n\tBitOffset  int64 // within the ByteSize bytes at ByteOffset",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "676fead7_09d78ba6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 14020
      },
      "writtenOn": "2022-01-13T14:32:31Z",
      "side": 1,
      "message": "Thanks Dmitry for identifying this problem. I agree that in light of your example, this CL is very problematic.\n\nI went back and read the V4 and V3 standards again, and the language is frustratingly vague (terms like \"containing entity\" and \"storage unit\" are not always precisely nailed down) so it seems not surprising that this slipped through the cracks.\n\nWould it be helpful to file a new bug to track this issue?",
      "parentUuid": "edf0619d_daec236f",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "9c415d6f_bdf07ebf",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5400
      },
      "writtenOn": "2022-01-13T14:38:04Z",
      "side": 1,
      "message": "\u003e Would it be helpful to file a new bug to track this issue?\n\nIf it\u0027s not fixed right away, then yes.",
      "parentUuid": "676fead7_09d78ba6",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1cca273a_e2d28a25",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5167
      },
      "writtenOn": "2022-01-13T16:53:26Z",
      "side": 1,
      "message": "Is it possible to standardize the meaning of StructField.BitOffset on one of these two meanings and translate the other one? Based on the current comment, it seems we intended to give a field-relative bit offset. Though presumably DWARF switched to DW_AT_data_bit_offset for some reason, so maybe it\u0027s hard to translate that back in some situations?\n\nDmitry, could you clarify what you mean by \"in big-endian sense\" and \"in little endian-sense\"? I can imagine several things that could mean, like whether it\u0027s the offset of the most- or least- significant bit in the field, or exactly how you go from an offset to which byte that offset actually lands in.",
      "parentUuid": "9c415d6f_bdf07ebf",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "912fd7fa_26f0181a",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2022-01-13T16:58:04Z",
      "side": 1,
      "message": "I don\u0027t think it is reasonable to standardize.  The DWARF3 meaning is not very useful, and it\u0027s hard to convert the DWARF3 meaning to the DWARF4 meaning, and even if we could that would break compatibility (although it\u0027s hard to know how many people care).",
      "parentUuid": "1cca273a_e2d28a25",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "860155a9_7d27a94c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2022-01-13T17:10:04Z",
      "side": 1,
      "message": "There are two cases where we interpret DW_AT_bit_offset: for basic types and for struct fields.\n\nThe use for basic types is very unusual: it\u0027s only \"if the value of an object of the given type does not fully occupy the storage described by a byte size attribute.\"  I suggest that for that case we simply break compatibility: ignore any DW_AT_bit_offset attribute and only record the DW_AT_data_bit_offset value.  I would be amazed if that broke anybody, and of course over time DW_AT_bit_offset entries will disappear entirely.\n\nFor struct fields we could add a new field, although that would make a moderately common data type larger.  Or we could add a new method to Reader, akin to AddressSize and ByteReader, that returns the current DWARF version; that could be used to interpret the field in a StructField.  The downside would be that nobody would remember to do that.  Although over time that wouldn\u0027t matter as DW_AT_bit_offset disappears.\n\nAny other thoughts?",
      "parentUuid": "912fd7fa_26f0181a",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "c64df0d8_c87583a9",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 8
      },
      "lineNbr": 0,
      "author": {
        "id": 5400
      },
      "writtenOn": "2022-01-13T17:15:39Z",
      "side": 1,
      "message": "\u003e Dmitry, could you clarify what you mean by \"in big-endian sense\" and \"in little endian-sense\"?\n\nDW_AT_bit_offset is offset of the last bit of the bitfield from the end of the storage unit.\nDW_AT_data_bit_offset is offset of the first bit of the bitfield from the start of the struct.\nI assume \"natural\" ordering of bits within bytes.",
      "parentUuid": "860155a9_7d27a94c",
      "revId": "065f3808156c92d957fc1ad2a2a37e147ee628f4",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}