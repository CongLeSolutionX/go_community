{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "4512cd81_4c3256d6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2022-09-18T12:05:19Z",
      "side": 1,
      "message": "Please don\u0027t use unsafe here.",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f5394cf0_ffe89c37",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 59161
      },
      "writtenOn": "2022-09-18T12:51:58Z",
      "side": 1,
      "message": "I got it.",
      "parentUuid": "4512cd81_4c3256d6",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "82a88f49_9dad0405",
        "filename": "src/testing/testing.go",
        "patchSetId": 1
      },
      "lineNbr": 1324,
      "author": {
        "id": 52385
      },
      "writtenOn": "2022-09-18T03:58:19Z",
      "side": 1,
      "message": "As suggested by Ian, I think you should walk up the parent instead.",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ed873b59_a800a581",
        "filename": "src/testing/testing.go",
        "patchSetId": 1
      },
      "lineNbr": 1324,
      "author": {
        "id": 59161
      },
      "writtenOn": "2022-09-18T04:29:59Z",
      "side": 1,
      "message": "At first, I thought so too, but the type of `t.parent` is `*common` and `isParallel` is out of it like below: \n\n```\ntype T struct {\n\tcommon\n\tisParallel bool\n\tisEnvSet   bool\n\tcontext    *testContext\n}\n```\n\nCan I move `isParallel` into `common`, or is there any other way?\nAnd can I ignore the cost of tree walking?",
      "parentUuid": "82a88f49_9dad0405",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ba6599ce_e30a4927",
        "filename": "src/testing/testing.go",
        "patchSetId": 1
      },
      "lineNbr": 1324,
      "author": {
        "id": 52385
      },
      "writtenOn": "2022-09-18T06:05:28Z",
      "side": 1,
      "message": "It can be implemented with `unsafe.Pointer`. But I\u0027m not sure whether it\u0027s okay to use it here. The number of nested levels will be small most of the time. So I think the cost can be ignored.\n\n```diff\ndiff --git a/src/testing/testing.go b/src/testing/testing.go\nindex 0228d2904b..5efd1e379e 100644\n--- a/src/testing/testing.go\n+++ b/src/testing/testing.go\n@@ -387,6 +387,7 @@ import (\n    \"time\"\n    \"unicode\"\n    \"unicode/utf8\"\n+   \"unsafe\"\n )\n \n var initRan bool\n@@ -1318,8 +1319,10 @@ func (t *T) Parallel() {\n //\n // This cannot be used in parallel tests.\n func (t *T) Setenv(key, value string) {\n-   if t.isParallel {\n-       panic(\"testing: t.Setenv called after t.Parallel; cannot set environment variables in parallel tests\")\n+   for p :\u003d t; p !\u003d nil; p \u003d (*T)(unsafe.Pointer(p.parent)) {\n+       if p.isParallel {\n+           panic(\"testing: t.Setenv called after t.Parallel; cannot set environment variables in parallel tests\")\n+       }\n    }\n```",
      "parentUuid": "ed873b59_a800a581",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "63eda949_93a6cfe8",
        "filename": "src/testing/testing.go",
        "patchSetId": 1
      },
      "lineNbr": 1324,
      "author": {
        "id": 59161
      },
      "writtenOn": "2022-09-18T12:51:58Z",
      "side": 1,
      "message": "I confirmed that it can be walk up the parent using unsafe.\nBut I can\u0027t send this changes because Ian said \"Please don\u0027t use unsafe here.\".\n\nShould I move `isParallel` into `common` if it can\u0027t use unsafe? I want your opinion.",
      "parentUuid": "ba6599ce_e30a4927",
      "revId": "8f371de3d1c0fb5edb68cbbc4541e6102bf6a3a2",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}