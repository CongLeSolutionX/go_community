{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "2cd6ac35_d7e4c2a1",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 4
      },
      "lineNbr": 0,
      "author": {
        "id": 28759
      },
      "writtenOn": "2021-09-15T19:05:07Z",
      "side": 1,
      "message": "Hey Joe - is this still something you want to work on before the freeze, or should one of us plan to pick it up? Thanks!",
      "revId": "0aa72975411f2ca927deb8cd432d53caa0307d97",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2150224d_1c09302c",
        "filename": "src/testing/match.go",
        "patchSetId": 4
      },
      "lineNbr": 116,
      "author": {
        "id": 17092
      },
      "writtenOn": "2021-08-18T17:13:04Z",
      "side": 1,
      "message": "I really like this approach, and when this lands, I think we ought to cherry-pick it into master early. That said, I\u0027m finding the logic hard to follow (coffee hasn\u0027t kicked in yet), and I wonder if we could simplify a bit.\n\nWhat if instead of stripNumberSuffix, we instead had a function stripNameUniqueSuffixes that returned a string without any of the suffixes. So:\n\n  \"foo#01/bar/baz#123\" -\u003e \"foo/bar/baz\"\n\nWe can use those stripped strings as map keys, so nothing in the map will have those suffixes. I think that would even avoid the need to loop. Something like this?\n\n  stripped :\u003d fmt.Sprintf(\"%s/%s\", stripNameUniqueSuffixes(parent), subname)\n  name :\u003d fmt.Sprintf(\"%s/%s\", parent, subname)\n  next, exists :\u003d m.subNames[stripped]\n  if subname !\u003d \"\" \u0026\u0026 !exists {\n    m.subNames[stripped] \u003d 1\n    return name\n  }\n  name \u003d fmt.Sprintf(\"%s/%s%02d\", parent, subname, next)\n  m.subNames[stripped]++\n  return name\n\nI\u0027m not sure if this is correct. It lets users pass in a literal subname like \"foo#02\" and preserves that. Maybe that\u0027s okay though?",
      "revId": "0aa72975411f2ca927deb8cd432d53caa0307d97",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a8dd5a45_1b51216e",
        "filename": "src/testing/match.go",
        "patchSetId": 4
      },
      "lineNbr": 116,
      "author": {
        "id": 8495
      },
      "writtenOn": "2021-08-18T17:49:35Z",
      "side": 1,
      "message": "\u003e What if instead of stripNumberSuffix, we instead had a function stripNameUniqueSuffixes that returned a string without any of the suffixes. So:\n\nSomething similar to that was what I was alluding to in the CL description if we\u0027re willing to change the way names are generated.\n\nI don\u0027t like how the names can be arbitrarily nested (e.g., \"a#01#01#01\") as this creates lots of complexity. If it was a flat sequence, then the logic becomes simpler.\n\nI don\u0027t know if the auto-generation of names is technically covered by the Go compatibility agreement. Currently, my function is optimizing for backwards compatibility at the expense of complexity.\n\nBTW, you can play around with the algorithm with this snippet:\nhttps://play.golang.org/p/UJ6yM5Kr-e6\ncurrently the snippet you suggested has duplicates.",
      "parentUuid": "2150224d_1c09302c",
      "revId": "0aa72975411f2ca927deb8cd432d53caa0307d97",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f19fa0a2_f7eac100",
        "filename": "src/testing/match.go",
        "patchSetId": 4
      },
      "lineNbr": 116,
      "author": {
        "id": 17092
      },
      "writtenOn": "2021-08-18T20:40:57Z",
      "side": 1,
      "message": "Ah, I\u0027m sorry for that. I typed it out a bit hastily before a meeting and didn\u0027t test.\n\nFor compatibility, we\u0027re in Hyrum\u0027s Law territory, but I think as long as we\u0027re in the contract of T.Name, we\u0027re okay.\n\n\u003e If two sibling sub-tests have the same name, Name will append a suffix to guarantee the returned name is unique.\n\nThat sounds like any suffix is allowed, but the returned name must be unique, and we can\u0027t remove any part of the user-specified name.\n\nI\u0027ll take another look when I have a clearer head; pretty fried today to be honest.",
      "parentUuid": "a8dd5a45_1b51216e",
      "revId": "0aa72975411f2ca927deb8cd432d53caa0307d97",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2c478ed4_bb4d4da2",
        "filename": "src/testing/match.go",
        "patchSetId": 4
      },
      "lineNbr": 116,
      "author": {
        "id": 17092
      },
      "writtenOn": "2021-08-26T16:51:14Z",
      "side": 1,
      "message": "Sorry for taking so long to come back to this. Brain fog has been a real problem for me lately.\n\nI\u0027d still like to simplify this, even if it means an observable change in names (staying without the bounds of what T.Name promises though).\n\nHere\u0027s what I\u0027ve been trying. This version should avoid duplicates and should ensure subname is always there, even if it appears to contain a suffix. https://play.golang.org/p/GsuzNjjRNr-. WDYT of this approach?",
      "parentUuid": "f19fa0a2_f7eac100",
      "revId": "0aa72975411f2ca927deb8cd432d53caa0307d97",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}