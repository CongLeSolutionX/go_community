{
  "comments": [
    {
      "key": {
        "uuid": "8c645c3a_28af97a8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 2
      },
      "lineNbr": 0,
      "author": {
        "id": 12120
      },
      "writtenOn": "2020-07-27T20:11:41Z",
      "side": 1,
      "message": "I started this off a bit as Ian suggested, with a sched counter of \u0027pending\u0027 M\u0027s in the process of creation, which checkdead would consider running. However, it quickly gets ugly with many callsites needing to say they are starting an M even though it doesn\u0027t matter.\n\nExplicitly pre-allocating the ID like this to increase mcount() earlier ended up feeling much cleaner. Let me know what you think.\n\nIdeally, I think this would be cleanest with a refactor to allow newm() while holding sched.lock, but that would be a much bigger change, plus it brings a lot more stuff inside the critical section.",
      "revId": "299a009c0486516fed357ba4b74ba9a125f6e1f6",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "d0267848_3ebd4a9e",
        "filename": "src/runtime/proc.go",
        "patchSetId": 2
      },
      "lineNbr": 1086,
      "author": {
        "id": 12120
      },
      "writtenOn": "2020-07-27T20:40:33Z",
      "side": 1,
      "message": "I need to think about this case a bit more. It might need to pre-allocate the ID as well if it is possible for one of the woken P\u0027s to race with the others into stopm and hit the same checkdead case.",
      "revId": "299a009c0486516fed357ba4b74ba9a125f6e1f6",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "c18c96b8_3759637e",
        "filename": "src/runtime/proc.go",
        "patchSetId": 2
      },
      "lineNbr": 1944,
      "author": {
        "id": 5206
      },
      "writtenOn": "2020-07-27T20:16:25Z",
      "side": 1,
      "message": "Shouldn\u0027t this be\n    id :\u003d int64(-1)\n?",
      "revId": "299a009c0486516fed357ba4b74ba9a125f6e1f6",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "0f1a6d17_12c9af3a",
        "filename": "src/runtime/proc.go",
        "patchSetId": 2
      },
      "lineNbr": 1944,
      "author": {
        "id": 12120
      },
      "writtenOn": "2020-07-27T20:40:33Z",
      "side": 1,
      "message": "id is only used if mp \u003d\u003d nil, thus the default value doesn\u0027t matter, but I see how this is confusing. I think using two mp \u003d\u003d nil blocks to keep a single unlock call just adds more confusion than it saves.\n\nI\u0027ve merged them together, PTAL.",
      "parentUuid": "c18c96b8_3759637e",
      "revId": "299a009c0486516fed357ba4b74ba9a125f6e1f6",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    }
  ]
}