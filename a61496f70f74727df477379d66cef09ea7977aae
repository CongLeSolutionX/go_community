{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "e1489d0e_defcba23",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 25391
      },
      "writtenOn": "2023-06-16T14:13:19Z",
      "side": 1,
      "message": "just checking my understanding:\n\nAFAICT the issue is more specifically that a goroutine being readied by netpollready doesn\u0027t decrement it, which notably does *not* call netpollgoready, *only* netpollunblock?",
      "range": {
        "startLine": 9,
        "startChar": 43,
        "endLine": 10,
        "endChar": 58
      },
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ae58f575_0a29fbf7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 1
      },
      "lineNbr": 10,
      "author": {
        "id": 5206
      },
      "writtenOn": "2023-06-16T18:00:30Z",
      "side": 1,
      "message": "Yes.",
      "parentUuid": "e1489d0e_defcba23",
      "range": {
        "startLine": 9,
        "startChar": 43,
        "endLine": 10,
        "endChar": 58
      },
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "642df0d4_79361ec3",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2023-06-16T00:42:56Z",
      "side": 1,
      "message": "TryBots beginning. Status page: https://farmer.golang.org/try?commit\u003da61496f7\n",
      "tag": "autogenerated:trybots~beginning",
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "73e8570a_1e7bbb53",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2023-06-16T00:43:48Z",
      "side": 1,
      "message": "Because of the way the scheduler checks netpollWaiters, this may have subtle effects on scheduling behavior. This fixes a real bug, but a rare one; we may want to postpone to 1.22, and only backport after we have more experience with it.  Let me know what you think.",
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "67288f1d_5727553f",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2023-06-16T00:54:12Z",
      "side": 1,
      "message": "TryBots are happy.\n\n",
      "parentUuid": "642df0d4_79361ec3",
      "tag": "autogenerated:trybots~happy",
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "94b80af9_a1b2bb90",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 25391
      },
      "writtenOn": "2023-06-16T14:13:19Z",
      "side": 1,
      "message": "LGTM. IMO, this change definitely makes the handling of netpollWaiters more clearly correct, at least to me.\n\nit seems to me like the only effect it\u0027ll have is to let the scheduler skip unnecessary calls to netpoll. if I\u0027m understanding correctly, the worst case is then that this was masking a different bug in the logic, and we\u0027ll start missing important calls to netpoll that in the worst case will cause us to miss network wake-ups altogether (when there\u0027s nothing left to do).\n\nthe question is whether a race between netpollblock and the last possible chance to block in netpoll is something that could happen. I don\u0027t think it is, given that something calling netpollblock will gopark, then call back into the scheduler.\n\nbecause there\u0027s this clear condition of netpollWaiters being incremented followed by at least one guaranteed call into findRunnable that will observe the incremented value, I feel kind of OK about landing this.\n\nideally we would test on a big suite and check benchmarks just because it\u0027s later in the cycle. happy to run those if it would be helpful. I\u0027m also fine to leave it to 1.22; it\u0027s serious, but it seems like we\u0027ve had this bug for a long time?",
      "parentUuid": "73e8570a_1e7bbb53",
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "3f0ee9b6_2f2d66c2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2023-06-16T18:00:30Z",
      "side": 1,
      "message": "If it\u0027s easy to run scheduling benchmarks that use network connections with this CL, let\u0027s do that.  Otherwise I\u0027m inclined to wait until 1.22.  Thanks.",
      "parentUuid": "94b80af9_a1b2bb90",
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a96cb51f_9f25be1a",
        "filename": "src/runtime/netpoll.go",
        "patchSetId": 1
      },
      "lineNbr": 589,
      "author": {
        "id": 25391
      },
      "writtenOn": "2023-06-16T14:13:19Z",
      "side": 1,
      "message": "while we\u0027re here, this might be clearer as\n\nnew :\u003d pdNil",
      "range": {
        "startLine": 589,
        "startChar": 2,
        "endLine": 589,
        "endChar": 17
      },
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "355f34e7_85160a23",
        "filename": "src/runtime/netpoll.go",
        "patchSetId": 1
      },
      "lineNbr": 589,
      "author": {
        "id": 5206
      },
      "writtenOn": "2023-06-16T18:00:30Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "a96cb51f_9f25be1a",
      "range": {
        "startLine": 589,
        "startChar": 2,
        "endLine": 589,
        "endChar": 17
      },
      "revId": "a61496f70f74727df477379d66cef09ea7977aae",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}