{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "816d00a5_0291cd2c",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "Thanks, this is looking good. Some suggestions on how to polish the code.",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f58568fe_464c2ea2",
        "filename": "src/cmd/cgo/main.go",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "Change this code to:\n\n```\ninfo, err :\u003d dynimportRead(*dynimport)\nif err !\u003d nil {\n    fatalf(\"%s\", err)\n}\n\nif *dynout \u003d\u003d \"\" \u0026\u0026 *dynobjout \u003d\u003d \"\" {\n  dynimportWriteSourceFile(os.Stdout, *dynpackage, info)\n  return\n}\n\nif *dynout !\u003d \"\" {\n  f, err :\u003d os.Create(*dynout)\n  if err !\u003d nil {\n    fatalf(\"%s\", err)\n  }\n  dynimportWriteSourceFile(f, *dynpackage, info)\n  f.Close()\n}\n\nif *dynobjout !\u003d \"\" {\n  f, err :\u003d os.Create(*dynout)\n  if err !\u003d nil {\n    fatalf(\"%s\", err)\n  }\n  dynimportWriteObjectFile(f, info)\n  f.Close()\n}\n\nreturn\n```",
      "range": {
        "startLine": 269,
        "startChar": 1,
        "endLine": 282,
        "endChar": 16
      },
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "3cee2e45_491694b4",
        "filename": "src/cmd/cgo/main.go",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:42:23Z",
      "side": 1,
      "message": "\u003e if *dynobjout !\u003d \"\" {\n\u003e  f, err :\u003d os.Create(*dynout)\n\n(Sorry, typo: these should both be *dynobjout.)",
      "parentUuid": "f58568fe_464c2ea2",
      "range": {
        "startLine": 269,
        "startChar": 1,
        "endLine": 282,
        "endChar": 16
      },
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "56647224_2a4bb6b0",
        "filename": "src/cmd/cgo/main.go",
        "patchSetId": 1
      },
      "lineNbr": 282,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T07:17:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "3cee2e45_491694b4",
      "range": {
        "startLine": 269,
        "startChar": 1,
        "endLine": 282,
        "endChar": 16
      },
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "802e2e16_e4fd093c",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 325,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "Turn this into an API:\n\n```\nfunc dynimportWriteSourceFile(out io.Writer, pkgName string, info *dynimportInfo) {\n  fmt.Fprintf(out, \"packge %s\\n\", pkgName)\n  if info.Linker !\u003d \"\" {\n    fmt.Fprintf(out, \"//go:cgo_dynamic_linker %q\\n\", info.Linker)\n  }\n  for _, sym :\u003d range info.Syms {\n    fmt.Fprintf(out, \"//go:cgo_dynamic_linker %s %s %q\\n\", sym.Local, sym.Remote, sym.Library)\n  }\n}\n```",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "ef0a57d9_1b3bc91e",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 325,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T07:17:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "802e2e16_e4fd093c",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "75a1c42a_15daa1ce",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 337,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "Refactor the existing obj reading+parsing code into an API like:\n\n```\ntype dynimportInfo struct {\n    Linker string\n    Syms   []dynimportSym\n}\n\ntype dynimportSym struct {\n    Local, Remote, Library string\n}\n\nfunc dynimportRead(obj string) (*dynimportInfo, error)\n```",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "92a17a35_cf26ca0f",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 337,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T07:17:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "75a1c42a_15daa1ce",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9dd46b2d_47161f10",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 513,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "Similarly, make this into:\n\n```\nfunc dynimportWriteObjectFile(out io.Writer, info *dynimportInfo)\n```",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee9173cf_a1d0249a",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 513,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T05:13:54Z",
      "side": 1,
      "message": "Should this just be a method of `*dynimportInfo` then?",
      "parentUuid": "9dd46b2d_47161f10",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "21546035_9d9d8403",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 513,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T05:19:10Z",
      "side": 1,
      "message": "Sure, that sounds fine too.",
      "parentUuid": "ee9173cf_a1d0249a",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d7d13cfb_c39ea547",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 513,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T07:17:53Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "21546035_9d9d8403",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e52fc9ed_473e4488",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 520,
      "author": {
        "id": 5440
      },
      "writtenOn": "2021-06-17T03:39:29Z",
      "side": 1,
      "message": "This line should be omitted. This is the magic marker used for distinguishing .a files, but we\u0027re writing out just .o files here.",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "65964b20_360fa12a",
        "filename": "src/cmd/cgo/out.go",
        "patchSetId": 1
      },
      "lineNbr": 520,
      "author": {
        "id": 52538
      },
      "writtenOn": "2021-06-17T07:11:17Z",
      "side": 1,
      "message": "This change seems to cause a `slice bounds out of range` panic during building, and I\u0027m not too sure why. It worked fine with the line.\n\nError trace:\n\n```\n# cmd/trace\npanic: runtime error: slice bounds out of range [::8] with capacity 0\n\ngoroutine 1 [running]:\ncmd/internal/goobj.(*Reader).BytesAt(...)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/internal/goobj/objfile.go:614\ncmd/internal/goobj.(*Header).Read(0x6ceba8, 0xa0024000002c6)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/internal/goobj/objfile.go:234 +0x19a\ncmd/internal/goobj.NewReaderFromBytes({0x86b640, 0x0, 0x0}, 0x0)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/internal/goobj/objfile.go:602 +0x10d\ncmd/link/internal/loader.(*Loader).Preload(0xc000514000, 0x25, 0xc0000708b0, 0xc000546fc0, 0xc0001095f0, 0x7)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/internal/loader/loader.go:2074 +0x10b\ncmd/link/internal/ld.ldobj(0xc000160000, 0xc0000708b0, 0xc000546fc0, 0x327, {0xc0000207b0, 0x8}, {0xc000168be9, 0x1f})\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/internal/ld/lib.go:1942 +0xac7\ncmd/link/internal/ld.loadobjfile(0xc000160000, 0xc000546fc0)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/internal/ld/lib.go:998 +0x589\ncmd/link/internal/ld.(*Link).loadlib(0xc000160000)\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/internal/ld/lib.go:527 +0x270\ncmd/link/internal/ld.Main(_, {0x20, 0x20, 0x1, 0x7, 0x10, 0x0, {0x0, 0x0}, {0x678943, ...}, ...})\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/internal/ld/main.go:249 +0xd8b\nmain.main()\n        /nix/store/ml5pa6flqv0nzdrc1nzys7knvp5b2ii3-go2-unstable-tip/share/go/src/cmd/link/main.go:69 +0x1005\n```",
      "parentUuid": "e52fc9ed_473e4488",
      "revId": "720a35e1d4f39940b77da5e09f24a182e0f688f7",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}