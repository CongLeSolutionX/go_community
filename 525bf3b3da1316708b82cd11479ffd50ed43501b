{
  "comments": [
    {
      "key": {
        "uuid": "cfe97c20_4cbbf4fb",
        "filename": "src/runtime/proc.go",
        "patchSetId": 23
      },
      "lineNbr": 4110,
      "author": {
        "id": 25391
      },
      "writtenOn": "2019-10-07T21:39:39Z",
      "side": 1,
      "message": "my gut reaction was that this could lead to a deadlock because these locks aren\u0027t ordered, but I think there\u0027s actually an implicit ordering here since a destroyed P will always have a higher ID than the P you\u0027re putting this into. a comment about that would be nice but...\n\nthis is happening during STW anyway, so I\u0027m not sure that even matters at all. maybe it\u0027s even fine to just not use the locks at all?",
      "range": {
        "startLine": 4109,
        "startChar": 0,
        "endLine": 4110,
        "endChar": 22
      },
      "revId": "525bf3b3da1316708b82cd11479ffd50ed43501b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "b2d63059_2c2eaf47",
        "filename": "src/runtime/proc.go",
        "patchSetId": 23
      },
      "lineNbr": 4110,
      "author": {
        "id": 5206
      },
      "writtenOn": "2019-10-09T04:47:09Z",
      "side": 1,
      "message": "I took out the lock calls.",
      "parentUuid": "cfe97c20_4cbbf4fb",
      "range": {
        "startLine": 4109,
        "startChar": 0,
        "endLine": 4110,
        "endChar": 22
      },
      "revId": "525bf3b3da1316708b82cd11479ffd50ed43501b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "190587a8_c491a973",
        "filename": "src/runtime/proc.go",
        "patchSetId": 23
      },
      "lineNbr": 4111,
      "author": {
        "id": 25391
      },
      "writtenOn": "2019-10-07T21:39:39Z",
      "side": 1,
      "message": "if we scale down GOMAXPROCS very suddenly with many pending timers, this might try to put an large amount of timers onto just one P. I haven\u0027t looked at further changes but does this try to put the timers on some global list if it\u0027s too much or try to shard it in some way?",
      "range": {
        "startLine": 4111,
        "startChar": 2,
        "endLine": 4111,
        "endChar": 31
      },
      "revId": "525bf3b3da1316708b82cd11479ffd50ed43501b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "a2f19b13_2378ced8",
        "filename": "src/runtime/proc.go",
        "patchSetId": 23
      },
      "lineNbr": 4111,
      "author": {
        "id": 5206
      },
      "writtenOn": "2019-10-09T04:47:09Z",
      "side": 1,
      "message": "The system is designed to work well even if all the timers wind up on one P.  the moveTimers function is the only loop that iterates through all the timers.  The timers in general are maintained as a heap, so loop iterations grow at most as fast as the log of the number of timers.  If this turns out to be a problem we can add a global list as you suggest, but I don\u0027t expect that will be necessary.",
      "parentUuid": "190587a8_c491a973",
      "range": {
        "startLine": 4111,
        "startChar": 2,
        "endLine": 4111,
        "endChar": 31
      },
      "revId": "525bf3b3da1316708b82cd11479ffd50ed43501b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "70e0417a_7e7da269",
        "filename": "src/runtime/proc.go",
        "patchSetId": 23
      },
      "lineNbr": 4111,
      "author": {
        "id": 25391
      },
      "writtenOn": "2019-10-09T22:19:08Z",
      "side": 1,
      "message": "good point. my concern comes from the treap implementation in mgclarge.go, but this heap is perfectly balanced, stored in an array, and unlikely to get big enough to spill out of an L1 cache.",
      "parentUuid": "a2f19b13_2378ced8",
      "range": {
        "startLine": 4111,
        "startChar": 2,
        "endLine": 4111,
        "endChar": 31
      },
      "revId": "525bf3b3da1316708b82cd11479ffd50ed43501b",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705",
      "unresolved": false
    }
  ]
}