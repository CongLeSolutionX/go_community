{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "797b4bed_52e3f7ed",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 28759
      },
      "writtenOn": "2021-09-27T20:14:50Z",
      "side": 1,
      "message": "TRY\u003ddarwin-amd64-longtest,linux-amd64-longtest,windows-amd64-longtest",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "0699df0c_e31961e5",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2021-09-27T20:15:09Z",
      "side": 1,
      "message": "SlowBots beginning. Status page: https://farmer.golang.org/try?commit\u003d6d52295d",
      "tag": "autogenerated:trybots~beginning",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "e5e2faf8_4515aec2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2021-09-27T20:24:22Z",
      "side": 1,
      "message": "Build is still in progress... Status page: https://farmer.golang.org/try?commit\u003d6d52295d\nFailed on android-amd64-emu: https://storage.googleapis.com/go-build-log/6d52295d/android-amd64-emu_ea3b054b.log\nOther builds still in progress; subsequent failure notices suppressed until final report.\n\nConsult https://build.golang.org/ to see whether they are new failures. Keep in mind that TryBots currently test *exactly* your git commit, without rebasing. If your commit\u0027s git parent is old, the failure might\u0027ve already been fixed.\n",
      "parentUuid": "0699df0c_e31961e5",
      "tag": "autogenerated:trybots~progress",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "4433a5ba_c33010ae",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 5976
      },
      "writtenOn": "2021-09-27T20:42:45Z",
      "side": 1,
      "message": "1 of 28 SlowBots failed.\nFailed on android-amd64-emu: https://storage.googleapis.com/go-build-log/6d52295d/android-amd64-emu_ea3b054b.log\n\nConsult https://build.golang.org/ to see whether they are new failures. Keep in mind that TryBots currently test *exactly* your git commit, without rebasing. If your commit\u0027s git parent is old, the failure might\u0027ve already been fixed.\n\nSlowBot builds that ran:\n* linux-amd64-longtest\n* windows-amd64-longtest\n",
      "parentUuid": "0699df0c_e31961e5",
      "tag": "autogenerated:trybots~failed",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "ee5fb256_0089d392",
        "filename": "src/cmd/go/internal/load/pkg.go",
        "patchSetId": 1
      },
      "lineNbr": 2640,
      "author": {
        "id": 17092
      },
      "writtenOn": "2021-09-27T20:40:49Z",
      "side": 1,
      "message": "Could you add a comment somewhere explaining why this is needed and ideally a test? Or a TODO for me to do the same?\n\nIn context, it\u0027s not clear at all why this is needed since appendFlags is only used here, and setToolFlags is presumably only called once per package. When I removed it, nothing broke, so it actually didn\u0027t seem necessary.",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "100b8819_f0dcfe02",
        "filename": "src/cmd/go/internal/load/pkg.go",
        "patchSetId": 1
      },
      "lineNbr": 2640,
      "author": {
        "id": 28759
      },
      "writtenOn": "2021-09-28T18:15:08Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "ee5fb256_0089d392",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "be81e101_3bff3de0",
        "filename": "src/cmd/go/internal/load/pkg.go",
        "patchSetId": 1
      },
      "lineNbr": 2641,
      "author": {
        "id": 6365
      },
      "writtenOn": "2021-09-27T20:45:25Z",
      "side": 1,
      "message": "This still seems too stateful / racy to me.\n\nHere we\u0027re relying on a state transition in the Gcflags field. Earlier, as far as I can tell, the field was either nil or fully-populated, but now it is either empty, roughed-in, or fully-populated, with the status not clearly indicated in the code and the mutations to the shared state even occurring in separate packages (`work` vs. `load`).\n\nLooking at the code in a bit more depth, I see that the p.Internal.Gcflags field seems to be intended to hold only explicit, per-package gcflags. There is a separate `work.forcedGcflags` variable that holds global, tool-wide flags,¹ and also separate fields of the `PackageInternal` struct for per-package variations like `CoverMode`.\n\nGiven that the cmd/go/internal/work package is already the one that defines FuzzInstrumentFlags, I think those flags probably make the most sense as an internal detail of the `work` package, toggled by a PackageInternal field along the lines of `CoverMode` (perhaps `FuzzInstrument bool`?).\n\nThen the `cmd/go/internal/test` package would set `p.Internal.FuzzInstrument \u003d true`, and the `work` package would use the state of the `FuzzInstrument` field to add whatever gcflags, ldflags, etc. are needed.\n\n¹https://cs.opensource.google/go/go/+/master:src/cmd/go/internal/work/gc.go;l\u003d146;drc\u003dmaster",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "23230c5f_302d92ee",
        "filename": "src/cmd/go/internal/load/pkg.go",
        "patchSetId": 1
      },
      "lineNbr": 2641,
      "author": {
        "id": 28759
      },
      "writtenOn": "2021-09-28T18:15:08Z",
      "side": 1,
      "message": "Thanks for the idea. I went ahead and did something pretty similar to what I think you were suggesting, and confirmed that it now works as expected. LMK if you see issues with what I\u0027ve done.",
      "parentUuid": "be81e101_3bff3de0",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "8ab3c7b7_5aead2db",
        "filename": "src/cmd/go/internal/load/pkg.go",
        "patchSetId": 1
      },
      "lineNbr": 2641,
      "author": {
        "id": 28759
      },
      "writtenOn": "2021-09-28T18:15:08Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "be81e101_3bff3de0",
      "revId": "6d52295d54aba4a2b8f65564daefd0f78dfe4f0f",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}