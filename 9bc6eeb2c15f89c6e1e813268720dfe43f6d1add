{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "ba2b2c6a_5acbc0a8",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 5673
      },
      "writtenOn": "2020-11-22T13:24:45Z",
      "side": 1,
      "message": "I don\u0027t have any strong opinions on the code, but I have misgivings about a design that adds a layer of file descriptor caching here. Anecdotally it seems like trying to cache these resources is a risky approach.\n\nPerhaps the TCP path in io.Copy could be changed to only call Splice once X bytes have been sent? That might amortize the cost of the pipe allocation. Alternatively, could the pipe be moved into the FD struct here? That way it\u0027s lifetime could be pinned to the file descriptor of the TCP connection.\n\nI would appreciate more data or reproduction of the problem \u0026 discussion about potential designs in #42740 before proceeding with a solution.",
      "revId": "9bc6eeb2c15f89c6e1e813268720dfe43f6d1add",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d9390608_55042cb2",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 34725
      },
      "writtenOn": "2020-11-22T14:02:49Z",
      "side": 1,
      "message": "I don\u0027t agree with the idea of Embedding a pipe buffer into net.FD, it makes no difference in a scenario where a massive of TCP connections are created and destroyed, a tons of pipe buffers are still going to be created and destroyed along with connections.\n\nThe pipe pool is used to recycle resources, reusing pipe buffers to avoid too many system calls and wasted system resources.",
      "parentUuid": "ba2b2c6a_5acbc0a8",
      "revId": "9bc6eeb2c15f89c6e1e813268720dfe43f6d1add",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "497e6c2b_1bdd1e98",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 34725
      },
      "writtenOn": "2020-11-22T14:10:15Z",
      "side": 1,
      "message": "So embedding pipe into net.FD won\u0027t resolve the problem of making excessive system calls during the creation and destruction of TCP connections at high frequency.",
      "parentUuid": "d9390608_55042cb2",
      "revId": "9bc6eeb2c15f89c6e1e813268720dfe43f6d1add",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "b24e3933_2a977827",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 5673
      },
      "writtenOn": "2020-11-22T14:13:06Z",
      "side": 1,
      "message": "\u003e So embedding pipe into net.FD won\u0027t resolve the problem of making excessive system calls during the creation and destruction of TCP connections at high frequency.\n\nI meant the poll.FD struct used in the arguments to Splice.",
      "parentUuid": "497e6c2b_1bdd1e98",
      "revId": "9bc6eeb2c15f89c6e1e813268720dfe43f6d1add",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4bf96aa4_56368055",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 15
      },
      "lineNbr": 0,
      "author": {
        "id": 5206
      },
      "writtenOn": "2021-03-08T20:54:46Z",
      "side": 1,
      "message": "Ack",
      "parentUuid": "b24e3933_2a977827",
      "revId": "9bc6eeb2c15f89c6e1e813268720dfe43f6d1add",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}