{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "2dcb94ef_37f6674d",
        "filename": "src/syscall/syscall_windows.go",
        "patchSetId": 14
      },
      "lineNbr": 540,
      "author": {
        "id": 6365
      },
      "writtenOn": "2023-06-12T19:52:19Z",
      "side": 1,
      "message": "https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcurrentdirectory says:\n\n“To determine the required buffer size, set this parameter to NULL and the nBufferLength parameter to 0.”\n\nPerhaps we should do that instead of looping? That would bound the number of required system calls to just two (one to get the buffer size and one to get the CWD), or perhaps three if we want to try once with the 300-character buffer first as a common-case optimization.",
      "range": {
        "startLine": 538,
        "startChar": 59,
        "endLine": 540,
        "endChar": 30
      },
      "revId": "643699856871a926a2d166e5339a1a6e6bc92491",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "9359155e_1d6ef29d",
        "filename": "src/syscall/syscall_windows.go",
        "patchSetId": 14
      },
      "lineNbr": 540,
      "author": {
        "id": 63314
      },
      "writtenOn": "2023-06-13T17:41:00Z",
      "side": 1,
      "message": "IIUC this would only work if the current directory did not change during the two calls, and we\u0027ll still need to loop in general.",
      "parentUuid": "2dcb94ef_37f6674d",
      "range": {
        "startLine": 538,
        "startChar": 59,
        "endLine": 540,
        "endChar": 30
      },
      "revId": "643699856871a926a2d166e5339a1a6e6bc92491",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "8319254d_b2147197",
        "filename": "src/syscall/syscall_windows.go",
        "patchSetId": 14
      },
      "lineNbr": 540,
      "author": {
        "id": 6365
      },
      "writtenOn": "2023-06-13T19:30:26Z",
      "side": 1,
      "message": "Ah!\n\n“If the buffer that is pointed to by lpBuffer is not large enough, the return value specifies the required size of the buffer, in characters, including the null-terminating character.”\n\nIn the vast majority of cases the length of the CWD will not be increasing between calls, so I don\u0027t think ensuring exponential growth in that case is worth the extra code complexity — let\u0027s just use the size suggested by the call.\n\n```\nfor {\n\tn, e :\u003d GetCurrentDirectory(uint32(len(b)), \u0026b[0])\n\tif e !\u003d nil {\n\t\treturn \"\", e\n\t}\n\tif int(n) \u003c\u003d len(b) {\n\t\treturn UTF16ToString(b[:n]), nil\n\t}\n\tb \u003d make([]uint16, n)\n}\n```",
      "parentUuid": "9359155e_1d6ef29d",
      "range": {
        "startLine": 538,
        "startChar": 59,
        "endLine": 540,
        "endChar": 30
      },
      "revId": "643699856871a926a2d166e5339a1a6e6bc92491",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "a1412ecb_174a8ca2",
        "filename": "src/syscall/syscall_windows.go",
        "patchSetId": 14
      },
      "lineNbr": 540,
      "author": {
        "id": 63314
      },
      "writtenOn": "2023-06-14T10:00:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "8319254d_b2147197",
      "range": {
        "startLine": 538,
        "startChar": 59,
        "endLine": 540,
        "endChar": 30
      },
      "revId": "643699856871a926a2d166e5339a1a6e6bc92491",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "2ff15d58_8f565939",
        "filename": "src/syscall/syscall_windows.go",
        "patchSetId": 14
      },
      "lineNbr": 540,
      "author": {
        "id": 5070
      },
      "writtenOn": "2023-06-24T01:01:16Z",
      "side": 1,
      "message": "This code assumes that GetCurrentDirectory never returns error, if its second parameter is not nil. But I don\u0027t see that stated anywhere in the docs https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-getcurrentdirectory . Did I miss anything?",
      "parentUuid": "a1412ecb_174a8ca2",
      "range": {
        "startLine": 538,
        "startChar": 59,
        "endLine": 540,
        "endChar": 30
      },
      "revId": "643699856871a926a2d166e5339a1a6e6bc92491",
      "serverId": "62eb7196-b449-3ce5-99f1-c037f21e1705"
    }
  ]
}